<?xml version="1.0" encoding="UTF-8"?>
<blueprint	xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0" 
			xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
			xmlns:cm="http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.1.0"
			xmlns:camel="http://camel.apache.org/schema/blueprint"
			xsi:schemaLocation="http://www.osgi.org/xmlns/blueprint/v1.0.0 http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd
								http://camel.apache.org/schema/blueprint http://camel.apache.org/schema/blueprint/camel-blueprint.xsd">


	<!-- Get a reference to a publisher service. -->
	<reference id="spaceSystemPublisherService" 
			   interface="org.hbird.core.spacesystempublisher.interfaces.SpaceSystemPublisher">
	</reference>
	
	<!-- Command information service impl bean which uses the publisher to get command info -->
	<bean id="commandInformationService" 
		  class="org.hbird.application.commanding.provided.info.HbirdPublisherBasedCommandInfo"
		  init-method="init">
		<property name="publisher" ref="spaceSystemPublisherService"></property>
	</bean>
	
	<bean id="commandsToSend" class="org.hbird.application.commanding.provided.processing.CachedCommandList"></bean>

	<bean id="commandInModelChecker" class="org.hbird.application.commanding.provided.processing.CommandInModelChecker"></bean>

	<!-- Register command applications command information service as an OSGi service -->
	<service id="commandInfoService" 
			 interface="org.hbird.application.commanding.interfaces.info.CommandInformationService"
			 ref="commandInformationService">
	</service>
	
	<camel:camelContext>
		<camel:route id="commandAccepting">
			<camel:from uri="activemq:sendCommands"></camel:from>
			<camel:to uri="bean:commandsToSend"></camel:to>
		</camel:route>
		
		<camel:route>
			<camel:from></camel:from>
			<camel:filter>
				<camel:method bean="commandInModelChecker" method="checkCommand"></camel:method>
				<camel:to uri="activemq:dispatchedCommands"></camel:to>
			</camel:filter>
		</camel:route>
	</camel:camelContext>
	
</blueprint>